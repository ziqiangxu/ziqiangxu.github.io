# Deepinå¦‚ä½•ä¼‘çœ 

[deepinå®˜ç½‘](https://www.deepin.org)
ä¼‘çœ è¿™ä¸ªåŠŸèƒ½è¿˜æ˜¯å¾ˆé…·å¾ˆå®ç”¨çš„ï¼Œå¯¹äº `Linux` ç³»ç»Ÿï¼Œä¼‘çœ ä¸€èˆ¬å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç¡¬ç›˜ï¼ˆ`swap`æ–‡ä»¶ï¼‰ï¼Œç„¶åå…³æœºã€‚åœ¨ä¸‹ä¸€æ¬¡å¼€æœºçš„æ—¶å€™å°†æ•°æ®é‡æ–°è½½å…¥å†…å­˜ï¼Œè®©ä½ å¿«é€Ÿå›åˆ°ä¸Šä¸€æ¬¡çš„å·¥ä½œçŠ¶æ€ï¼Œè¿™åœ¨ä½ å¼€å¯äº†å¤§é‡çš„ç¨‹åºä½†éœ€è¦æš‚åœå·¥ä½œçš„æ—¶å€™å°¤å…¶å¥½ç”¨ã€‚

## æƒ…å†µä¸€

å¦‚æœä½ çš„ç”µè„‘æœ‰ `swap` åˆ†åŒºï¼Œ `deepin` ä¼šæ¢æµ‹åˆ°ï¼Œå…³æœºçš„æ—¶å€™ä¼šæœ‰ä¼‘çœ é€‰é¡¹äº†ï¼Œè¿™ä¸ªåŠŸèƒ½ç»ˆäºåŠ åˆ°å…³æœºèœå•é‡Œäº†ï¼Œç»™ `deepin` ç‚¹èµã€‚

~~ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªå¯ä»¥æ­£å¸¸ä½¿ç”¨çš„swapåˆ†åŒºï¼Œåªéœ€è¦åœ¨ç»ˆç«¯æ‰§è¡Œ~~
~~```systemctl hibernate```~~
~~å°±å¯ä»¥ä¼‘çœ äº†ã€‚~~
~~å¦‚æœä½ ä¼‘çœ ä¹‹åå¼€æœºå‘ç°ä½ çš„ç”µè„‘å¹¶æ²¡æœ‰æ¢å¤ç°åœºï¼Œåˆ™éœ€è¦æŒ‡å®šä¸€ä¸‹å¯åŠ¨çš„ç£ç›˜ï¼ˆä»swapåˆ†åŒºå¯åŠ¨ï¼‰ï¼Œæ“ä½œæ–¹æ³•å¦‚ä¸‹ï¼š~~
~~ä¿®æ”¹/etc/default/grubè¿™ä¸ªæ–‡ä»¶ä¸­çš„ç›¸å…³å†…å®¹~~
~~```GRUB_CMDLINE_LINUX_DEFAULT="resume=/dev/sda3 quiet"```
å…¶ä¸­/dev/sda3æ”¹ä¸ºä½ çš„swapåˆ†åŒºå¯¹åº”çš„æ ‡å¿—å³å¯ï¼ˆæ¨èä½¿ç”¨gpartedæŸ¥çœ‹ï¼‰
ç„¶åå†æ‰§è¡Œ~~
~~```sudo update-grub```~~

## æƒ…å†µäºŒ

å¦‚æœä½ æ²¡åŠæ³•ä»ç¡¬ç›˜åˆ’åˆ†ä¸€ä¸ªswapåˆ†åŒºï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨swapæ–‡ä»¶æ¥è¿›è¡Œä¼‘çœ ã€‚
[æœ¬æ•™ç¨‹å‚è€ƒäº†Debiançš„wiki](https://wiki.debian.org/Hibernation/Hibernate_Without_Swap_Partition)
å¤§ä½“æ€è·¯ï¼šåˆ›å»ºswapæ–‡ä»¶-->é…ç½®swapæ–‡ä»¶-->å®‰è£…uswsusp-->é…ç½®uswsusp

### 1. åˆ›å»ºä¸€ä¸ªswapæ–‡ä»¶

``` shell
fallocate -l 256m /swap
mkswap /swap
```

â€œ256â€æ˜¯æŒ‡ä»¥MBä¸ºå•ä½çš„å¤§å°ï¼ˆå…¶åçš„'m'ï¼‰ã€‚å°†å…¶è®¾ç½®ä¸ºRAMçš„è‡³å°‘ä¸€åŠå¤§å°(è¿™ä¸ªæ˜¯debian wikiç»™å®šçš„æ•°æ®ï¼Œæˆ‘å»ºè®®è®¾ç½®ä¸ºè‡³å°‘è®¾ç½®ä¸ºå†…å­˜ç›¸åŒå¤§å°)ã€‚â€œ/swapâ€æ˜¯äº¤æ¢æ–‡ä»¶çš„è·¯å¾„ã€‚å®ƒå¯ä»¥ä½äºä»»ä½•åˆ†åŒºï¼ˆä¾‹å¦‚rootæˆ–homeï¼‰ã€‚

### 2. è¿›è¡Œswapæ–‡ä»¶ç›¸å…³è®¾ç½®

- æŒ‚è½½swapæ–‡ä»¶
å°†æ­¤è¡Œæ·»åŠ åˆ°/etc/fstabæ–‡ä»¶ä¸­ï¼š
`/swap swap swap defaults 0 0` 

- å‡å°‘ä½¿ç”¨swapæ–‡ä»¶
ç»ˆç«¯æ‰§è¡Œ `sudo sysctl -w vm.swappiness = 1`
å¹¶åœ¨/etc/sysctl.dä¸­åˆ›å»ºä¸€ä¸ªåä¸ºlocal.confçš„æ–‡ä»¶ï¼Œä¸ºäº†ä½¿vm.swappinessä¿æŒä¸å˜ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:

``` text
vm.swappiness = 1
```

> [vm.swappinessæ‰©å±•çŸ¥è¯†](http://blog.sina.com.cn/s/blog_13cc013b50102wskd.html)
å‡å°‘å†…æ ¸å¯¹ `swap` çš„ä½¿ç”¨è¿™ä¸€æ­¥ä¸»è¦æ˜¯é’ˆå¯¹ä½¿ç”¨æœºæ¢°ç¡¬ç›˜çš„åŒå­¦ï¼Œå› ä¸ºåœ¨æœºæ¢°ç¡¬ç›˜ä¸­å¤§é‡å¯¹ `swap` è¿›è¡Œè¯»å†™ä¼šæ‹–æ…¢ç³»ç»Ÿçš„é€Ÿåº¦ï¼Œ Debian wiki é‡Œé¢å†™çš„æ˜¯åœæ­¢å†…æ ¸ä½¿ç”¨ `swap` æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯åŸä½œè€…ç¬”è¯¯ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»–çè¯´çš„ğŸ¤—

- æ¿€æ´»swapæ–‡ä»¶ï¼š
ç»ˆç«¯æ‰§è¡Œ `sudo swapon /swap`

### 3. å®‰è£…å’Œé…ç½®ç›¸å…³è½¯ä»¶

ä½¿ç”¨uswsuspè¿™ä¸ªè½¯ä»¶ï¼Œè¿™æ˜¯linuxå†…æ ¸ä½¿ç”¨swapæ–‡ä»¶ä»£æ›¿swapåˆ†åŒºæ¥è¿›è¡ŒæŒ‚èµ·ï¼ˆä¼‘çœ ï¼‰çš„æ–¹æ³•ï¼Œå¹¶ä¸”è¿˜æ”¯æŒå‹ç¼©å’ŒåŠ å¯†ç­‰åŠŸèƒ½ã€‚

- å®‰è£…uswsuspï¼š
ç»ˆç«¯æ‰§è¡Œ `aptitude install uswsusp`

- é…ç½®uswsuspï¼š
ç»ˆç«¯æ‰§è¡Œ `sudo dpkg-reconfigure -pmedium uswsusp`ï¼Œç„¶åä¼šå‡ºç°å¦‚ä¸‹æç¤ºæ¡†
![æ·±åº¦æˆªå›¾_é€‰æ‹©åŒºåŸŸ_20180605160224.png](https://upload-images.jianshu.io/upload_images/6434906-f8a2c6817f602996.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
ä»è¿™ä¸ªé—®é¢˜å¼€å§‹å…¨éƒ¨é€‰æ‹©ç¡®å®šï¼Œç›´åˆ°å‡ºç°ï¼š

![é€‰æ‹©swapæ–‡ä»¶](https://upload-images.jianshu.io/upload_images/6434906-56736ba5323f58ad.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
æ­¤å¤„é€‰æ‹©ä½ è¦ä½¿ç”¨çš„swapæ–‡ä»¶ï¼Œæ³¨ï¼šæˆ‘è¿™é‡Œæ˜¯/var/swapfileè¿™ä¸ªæ–‡ä»¶

![é€‰æ‹©æ˜¯å¦å¯¹ä¼‘çœ å†™å…¥swapçš„æ•°æ®åŠ å¯†](https://upload-images.jianshu.io/upload_images/6434906-e5389c6168ee53db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
æ ¹æ®éœ€è¦é€‰æ‹©å°±å¥½ï¼ˆéœ€è¦çŸ¥æ™“çš„æ˜¯ï¼Œå¼€å¯åŠ å¯†åŠŸèƒ½ä¹‹åä¼‘çœ çš„å¯åŠ¨æ‰€æ¶ˆè€—çš„æ—¶é—´ä¼šå¢åŠ ï¼‰ã€‚å¦‚æœé€‰æ‹©åŠ å¯†çš„è¯ï¼Œå®ƒä¼šæç¤ºä½ è®¾å®šä¸€ä¸ªå¯†ç 

- å¯¹uswsuspè¿›è¡Œè¿›ä¸€æ­¥é…ç½®

ä¸€èˆ¬é…ç½®æ–‡ä»¶/etc/uswsusp.confå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š

``` text
ï¼ƒ/etc/uswsusp.confï¼ˆ8ï¼‰ -- Configuration file for s2disk / s2both

resume device= /swap

compress = y

early writeout= y

image size= 238941634

RSA key file = /etc/uswsusp.key

shutdown method = platform

resume offset = 8288

# encrypt = y å¦‚æœä½ é€‰æ‹©äº†å¯¹æ•°æ®åŠ å¯†ï¼Œåˆ™ä¼šæœ‰è¿™ä¸€è¡Œ
```

`resume offset = 8288` æ˜¯äº¤æ¢æ–‡ä»¶å®é™…å­˜æ”¾çš„åœ°æ–¹ï¼ˆåº”è¯¥æ˜¯ç¡¬ç›˜çš„ç‰©ç†åœ°å€ï¼‰ã€‚ä½ å¯ä»¥ç»ˆç«¯æ‰§è¡Œ `swap-offset /swap` è·å¾—è¿™ä¸ªå€¼ã€‚
`resume device` å¿…é¡»æ˜¯åˆ†åŒºè€Œä¸æ˜¯äº¤æ¢æ–‡ä»¶ã€‚ä¸€èˆ¬è¿™è¡Œçš„å€¼ä¼šåœ¨ä¸Šä¸€æ­¥å®Œæˆåå˜æˆä½ çš„ `swap` æ–‡ä»¶çš„è·¯å¾„ï¼Œéœ€è¦æ”¹æˆä½ çš„ `swap` æ–‡ä»¶æ‰€åœ¨çš„åˆ†åŒºï¼Œå¦‚ `/dev/sda1`

ç¼–è¾‘ `/etc/uswsusp.conf` æ–‡ä»¶åï¼š
ç»ˆç«¯æ‰§è¡Œ `sudo update-initramfs -u`

1. é»˜è®¤å¯åŠ¨çš„é…ç½®
ä¸ºäº†è®©ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œé»˜è®¤ä»swapæ–‡ä»¶åŠ è½½æ•°æ®ã€‚å°† `/etc/default/grub` æ–‡ä»¶ä¸­çš„ç›¸å…³è®¾ç½®è¿›è¡Œä¿®æ”¹ï¼š
 `GRUB_CMDLINE_LINUX_DEFAULT ="resume = /dev/sda1 quiet"`
å…¶ä¸­ `/dev/sda1` æ˜¯äº¤æ¢æ–‡ä»¶æ‰€åœ¨çš„åˆ†åŒºã€‚
ç»ˆç«¯æ‰§è¡Œ `sudo update-grub`

## æµ‹è¯•ä¼‘çœ 

ç»ˆç«¯æ‰§è¡Œï¼š`sudo s2disk `

**æ³¨**ï¼šé…ç½®æˆåŠŸä¹‹åï¼Œå¦‚æœå†æ¬¡ä¿®æ”¹äº†uswsuspçš„è®¾ç½®éœ€è¦æ‰§è¡Œ 

``` shell
sudo update-initramfs -u
sudo update-grub
```

## é™„å½•

å¦‚æœä½ çš„ç£ç›˜åˆ†åŒºç»“æ„å˜äº†ï¼Œæ¯”å¦‚ `sda3` å˜æˆäº† `sda4`ï¼ŒæŒ‰ç…§ä¸Šé¢æ­¥éª¤å†æ¥ä¸€éå°±å¥½å•¦ï¼ˆå› ä¸ºéœ€è¦æ›´æ–° `grub` å’Œ `uswsusp.conf`ï¼‰ã€‚
